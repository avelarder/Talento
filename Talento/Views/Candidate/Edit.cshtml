@model Talento.Models.EditCandidateViewModel
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-body" id="edit-position-dialog-body">
            <form>
                <input type="hidden" id="CandidateId" name="CandidateId" value="data-candidate-id">
                <div class="modal-body">
                    <p><strong>Edit Profile</strong></p>
                    <div class="form-group row">
                        <label for="Candidateemail" class="col-md-2 col-form-label">Email</label>
                        <div class="col-md-4">
                            <input disabled class="form-control" type="text" id="CandidateEmail" value="@Model.Email">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="CandidateName" class="col-md-2 col-form-label">Name</label>
                        <div class="col-md-4">
                            <input class="form-control" type="text" id="CandidateName" name="Name" value="@Model.Name">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="CandidateCompetencies" class="col-md-2 col-form-label">Competencies</label>
                        <div class="col-md-4">
                            <textarea class="form-control" rows="6" type="text" id="CandidateCompetencies" name="Competencies" style="resize:none;">@Model.Competencies</textarea>
                        </div>
                    </div>
                    <div class="checkbox">
                        <label><input type="checkbox" value="">Is Tcs employee</label>
                    </div>
                    <div class="form-group row">
                        <label for="CandidateDescription" class="col-md-2 col-form-label">Description</label>
                        <div class="col-md-4">
                            <input class="form-control" type="text" id="Description" name="Description" value="@Model.Description">
                        </div>
                    </div>
                    <div class="form-group row">
                        @Html.Action("Edit", "File", new{ candidateId = Model.Id })
                    </div>
                </div>
            </form>
        </div>
        <div class="pmd-modal-action pmd-modal-bordered text-right">
            <button data-dismiss="modal" class="btn pmd-btn-flat pmd-ripple-effect btn-primary" type="button">Cancel</button>
            <button data-dismiss="modal" type="button" onclick="javascript: void (0);" class="btn pmd-btn-flat pmd-ripple-effect btn-default">Save</button>
        </div>
    </div>
</div>

<script>
    window.onload = function () {
        (function ($) {
            function addFile() {
                var formData = new FormData();
                formData.append('image', $('input[type=file]')[0].files[0]);
                $.ajax({
                    type: "POST",
                    url: '/File/Add',
                    data: formData,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    success: function (response) {

                    },
                    error: function (error) {
                        //Error is good enough because the result is always empty
                        updatelist();
                    }

                });
            }
            function deleteFile(filename) {
                var formData = new FormData();
                $.ajax({
                    type: "POST",
                    url: '/File/Delete',
                    data: "filename=" + filename,
                    success: function (response) {
                        updatelist();
                    },
                    error: function (error) {
                        updatelist();
                    }

                });
            }

            function buildFileList(filelist) {

                $("#fileListDiv").empty();
                for (i = 0; i < filelist.length; i++) {
                    $("#fileListDiv").append("<p id='file_" + filelist[i] + "'>" +
                        "<i class='material-icons'>insert_drive_file</i>" +
                        "<span>" + filelist[i].FileName + "</span>" +
                        "<i class='delete-file material-icons' data-file='" + filelist[i].FileName + "'>delete</i>" +
                        "</p>");
                }
            }

            $('#complete-dialog').on('hidden.bs.modal', function () {
                $("body").removeClass("modal-open");
                $.ajax({
                    type: "POST",
                    url: '/File/EmptyList',
                    dataType: 'json',
                    success: function (response) {
                        buildFileList(response);
                    },
                    error: function (error) {
                        //alert("holi2");
                    }
                });
                buildFileList();
                setTimeout(stopUpdate, 2000);
            });

            function updatelist() {
                $.ajax({
                    type: "POST",
                    url: '/File/ListCandidateFiles/',
                    data: {candidateId : @Model.Id}, 
                    dataType: 'json', 
                    success: function (response) {
                        buildFileList(response);
                    },
                    error: function (error) {
                        //alert("holi2");
                    }
                });
            }
            $(document).ready(function () {
                updatelist();
                $(".btn-modal").on("click", function () {
                    $("#Position_Id").val(($(this).attr("name")).split("-")[1]);
                });

                $("#Files").on("change", function () {
                    addFile();
                });
                $("#fileListDiv").on("click", ".delete-file", function () {
                    deleteFile($(this).attr('data-file'));
                });
            });
        }(jQuery));
    }
    
</script>
