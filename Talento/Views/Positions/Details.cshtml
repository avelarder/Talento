@using PagedList.Mvc; @*import this so we get our HTML Helper*@
@using PagedList; @*import this so we can cast our list to IPagedList (only necessary because ViewBag is dynamic)*@

@model Talento.Models.PositionModel
@{
    ViewBag.Title = "Position details";
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
}

<!-- import the included stylesheet for some (very basic) default styling -->
<link href="/Content/PagedList.css" rel="stylesheet" type="text/css" />

<div class="row">
    <div class="col-md-12">
        <h2>Positions</h2>
        <div>
            <div class="col-md-7">
                <b>Title:</b> @Html.DisplayFor(x => x.Title)
            </div>
            <div class="col-md-5">
                <b>Creation date:</b> @Html.DisplayFor(x => x.CreationDate)
            </div>
        </div>
        <div class="bottom">&nbsp;</div>
        <br />
        <div class="col-md-11">
            <p><b>Description: </b>@Html.DisplayFor(x => x.Description)</p>
            <p><b>Area: </b>@Html.DisplayFor(x => x.Area)<p />
            <p><b>Owner: </b>@Html.DisplayFor(x => x.Owner.UserName)<p />
            <p><b>Engagement Manager: </b>@Html.DisplayFor(x => x.EngagementManager)<p />
            <p><b>Portfolio Manager: </b>@Html.DisplayFor(x => x.PortfolioManager.UserName)<p />
            <p><b>RGS: </b>@Html.DisplayFor(x => x.RGS)<p />
            <p><b>Status: </b>@Html.DisplayFor(x => x.Status)<p />
        </div>
        <div class="col-md-8">
            @*<input type="button" name="back" class="btn pmd-ripple-effect btn-primary" value="Back" onclick="@("window.location.href='" + @Url.Action("Index", "Dashboard") + "'");" />*@
            <a href="@Url.Action("Index", "Dashboard")" alt="Back">
                <i class="material-icons md-24">keyboard_arrow_left</i>
            </a>

            @*<input type="button" name="edit" value="Edit" onclick="@("window.location.href='" + @Url.Action("Edit", "Positions", new { id = Model.Id }) + "'");" />*@
            <a href="@Url.Action("Edit", "Positions", new { id = Model.Id })" alt="Edit position">
                <i class="material-icons md-24">mode_edit</i>
            </a>

            @*<input data-target="#complete-dialog" data-toggle="modal" class="btn btn-danger pmd-ripple-effect btn-primary pmd-z-depth" value="Delete" />*@
            <a href="@Url.Action("Delete", "Positions")" data-target="#complete-dialog" alt="Delete position">
                <i class="material-icons md-24">delete</i>
            </a>

            <!--Delete position modal-->
            <div tabindex="-1" class="modal fade" id="complete-dialog" style="display: none;" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Delete profile</h4>
                        </div>
                        <div class="pmd-modal-action pmd-modal-bordered text-right">
                            <button data-dismiss="modal" class="btn pmd-btn-flat pmd-ripple-effect btn-primary" type="button">Cancel</button>
                            <button data-dismiss="modal" type="button" onclick="@("window.location.href='" + @Url.Action("Delete", "Positions", new { id = Model.Id }) + "'");" class="btn pmd-btn-flat pmd-ripple-effect btn-default">Delete</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--Delete position modal-->
        </div>
    </div>

    <div id="position-log-container">
        @* Partial of Logs *@
        <a href="#" class="container-close pmd-tooltip" data-toggle="tooltip" data-placement="left" title="Pagination Log">
            <i class="material-icons">format_list_bulleted</i>
        </a>
        @Html.Action("List", "Position", new { id = Model.Id })
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <h2>Candidates</h2>

        <!--pagination-->
        <table class="table" id="candidates-list">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Created On</th>
                    <th>Created By</th>
                    <th>Status</th>
                    <th>
                        <a href="#" data-toggle="modal" alt="Add profile">
                            <i class="material-icons md-24">note_add</i>
                        </a>
                    </th>
                </tr>
            </thead>
            @foreach (var cP in ViewBag.onePageOfCandidatePositions)
            {
                <tr>
                    <td>
                        @cP.Email
                    </td>
                    <td>
                        @cP.CratedOn
                    </td>
                    <td>
                        @cP.CreatedBy.Email
                    </td>
                    <td>
                        @cP.Status
                    </td>
                    <td>
                        <a href="@Url.Action("Edit", "Candidate",new { id = cP.Id, positionId = Model.Id } )" class="material-icons md-24 edit-candidate" data-toggle="modal" data-target="#edit-position-dialog" alt="Edit candidate">
                            mode_edit
                        </a>
                    </td>
                    <td>
                        <a href="#" data-toggle="modal" data-target="#delete-position-dialog" alt="Delete candidate">
                            <i class="material-icons md-24">delete</i>
                        </a>
                    </td>
                </tr>
            }
        </table>
        <script>
            window.onload = function () {
                (function ($) {
                    // start dude
                    var $parent = $('#candidates-list');
                    console.log("first trigger");
                    $parent.on("click", '.edit-candidate', function (event) {
                        console.log("candidate trigger");
                        event.preventDefault();
                        // vars
                        var $this = $(this);
                        var $target = $($this.attr('data-target'));
                        var $url = $this.attr('href');
                        $target.html('');
                        $.ajax({
                            url: $url
                        }).fail(function (err) {
                            var html = '<div class="modal-dialog"> \
                                < div class="modal-content" > \
                                    <div class="modal-body" id="edit-position-dialog-body"> Error:'+ err + '</div></div></div>';
                            $target.html(html);
                        }).done(function (result) {
                            console.log("Load trigger");
                            $target.html(result);
                            $target.modal()
                        });
                    });
                }(jQuery));
            }

        </script>
        <!--pagination-->
        <!-- output a paging control that lets the user navigation to the previous page, next page, etc -->
        @Html.PagedListPager((IPagedList)ViewBag.onePageOfCandidatePositions, page => Url.Action("Details", "Positions", new { Model.Id, page }))

        <!--Delete profile modal-->
        <div tabindex="-1" class="modal fade" id="delete-position-dialog" style="display: none;" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <p>Do you want to delete this profile?</p>
                    </div>
                    <div class="pmd-modal-action pmd-modal-bordered text-right">
                        <button data-dismiss="modal" class="btn pmd-btn-flat pmd-ripple-effect btn-primary" type="button">Cancel</button>
                        <button data-dismiss="modal" type="button" onclick="@("window.location.href='" + @Url.Action(null, null, new { id = Model.Id }) + "'");" class="btn pmd-btn-flat pmd-ripple-effect btn-default">Delete</button>
                    </div>
                </div>
            </div>
        </div>
        <!--Delete profile modal-->
        <!--Edit profile modal-->
        <div tabindex="-1" class="modal fade" id="edit-position-dialog" aria-hidden="true"></div>
    </div>
</div>